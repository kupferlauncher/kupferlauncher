<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta charset="utf-8"/>
<meta name="generator" content="Docutils 0.13.1: http://docutils.sourceforge.net/" />
<title>Kupfer Plugin API</title>
<style type="text/css">

/* Minimal style sheet for the HTML output of Docutils.                    */
/*                                                                         */
/* :Author: Günter Milde, based on html4css1.css by David Goodger          */
/* :Id: $Id: minimal.css 7952 2016-07-26 18:15:59Z milde $               */
/* :Copyright: © 2015 Günter Milde.                                        */
/* :License: Released under the terms of the `2-Clause BSD license`_,      */
/*    in short:                                                            */
/*                                                                         */
/*    Copying and distribution of this file, with or without modification, */
/*    are permitted in any medium without royalty provided the copyright   */
/*    notice and this notice are preserved.                                */
/*                                                                         */
/*    This file is offered as-is, without any warranty.                    */
/*                                                                         */
/* .. _2-Clause BSD license: http://www.spdx.org/licenses/BSD-2-Clause     */

/* This CSS2.1_ stylesheet defines rules for Docutils elements without    */
/* HTML equivalent. It is required to make the document semantic visible. */
/*                                                                        */
/* .. _CSS2.1: http://www.w3.org/TR/CSS2                                  */
/* .. _validates: http://jigsaw.w3.org/css-validator/validator$link       */

/* alignment of text and inline objects inside block objects*/
.align-left   { text-align: left; }
.align-right  { text-align: right; }
.align-center { clear: both; text-align: center; }
.align-top    { vertical-align: top; }
.align-middle { vertical-align: middle; }
.align-bottom { vertical-align: bottom; }

/* titles */
h1.title, p.subtitle {
  text-align: center;
}
p.admonition-title,
p.topic-title,
p.sidebar-title,
p.rubric,
p.system-message-title {
  font-weight: bold;
}
h1 + p.subtitle,
h1 + p.section-subtitle {
  font-size: 1.6em;
}
h2 + p.section-subtitle { font-size: 1.28em; }
p.subtitle,
p.section-subtitle,
p.sidebar-subtitle {
  font-weight: bold;
  margin-top: -0.5em;
}
p.sidebar-title,
p.rubric {
  font-size: larger;
}
p.rubric { color: maroon; }
a.toc-backref {
  color: black;
  text-decoration: none; }

/* Warnings, Errors */
div.caution p.admonition-title,
div.attention p.admonition-title,
div.danger p.admonition-title,
div.error p.admonition-title,
div.warning p.admonition-title,
div.system-messages h1,
div.error,
span.problematic,
p.system-message-title {
  color: red;
}

/* inline literals */
span.docutils.literal {
  font-family: monospace;
  white-space: pre-wrap;
}
/* do not wraph at hyphens and similar: */
.literal > span.pre { white-space: nowrap; }

/* Lists */

/* compact and simple lists: no margin between items */
.simple  li, .compact li,
.simple  ul, .compact ul,
.simple  ol, .compact ol,
.simple > li p, .compact > li p,
dl.simple > dd, dl.compact > dd {
  margin-top: 0;
  margin-bottom: 0;
}

/* Table of Contents */
div.topic.contents { margin: 0; }
ul.auto-toc {
  list-style-type: none;
  padding-left: 1.5em; }

/* Enumerated Lists */
ol.arabic     { list-style: decimal }
ol.loweralpha { list-style: lower-alpha }
ol.upperalpha { list-style: upper-alpha }
ol.lowerroman { list-style: lower-roman }
ol.upperroman { list-style: upper-roman }

dt span.classifier { font-style: italic }
dt span.classifier:before {
  font-style: normal;
  margin: 0.5em;
  content: ":";
}

/* Field Lists and drivatives */
/* bold field name, content starts on the same line */
dl.field-list > dt,
dl.option-list > dt,
dl.docinfo > dt,
dl.footnote > dt,
dl.citation > dt {
  font-weight: bold;
  clear: left;
  float: left;
  margin: 0;
  padding: 0;
  padding-right: 0.5em;
}
/* Offset for field content (corresponds to the --field-name-limit option) */
dl.field-list > dd,
dl.option-list > dd,
dl.docinfo > dd {
  margin-left:  9em; /* ca. 14 chars in the test examples */
}
/* start field-body on a new line after long field names */
dl.field-list > dd > *:first-child,
dl.option-list > dd > *:first-child
{
  display: inline-block;
  width: 100%;
  margin: 0;
}
/* field names followed by a colon */
dl.field-list > dt:after,
dl.docinfo > dt:after {
  content: ":";
}

/* Bibliographic Fields (docinfo) */
pre.address { font: inherit; }
dd.authors > p { margin: 0; }

/* Option Lists */
dl.option-list { margin-left: 40px; }
dl.option-list > dt { font-weight: normal; }
span.option { white-space: nowrap; }

/* Footnotes and Citations  */
dl.footnote.superscript > dd {margin-left: 1em; }
dl.footnote.brackets > dd {margin-left: 2em; }
dl > dt.label { font-weight: normal; }
a.footnote-reference.brackets:before,
dt.label > span.brackets:before { content: "["; }
a.footnote-reference.brackets:after,
dt.label > span.brackets:after { content: "]"; }
a.footnote-reference.superscript,
dl.footnote.superscript > dt.label {
  vertical-align: super;
  font-size: smaller;
}
dt.label > span.fn-backref { margin-left: 0.2em; }
dt.label > span.fn-backref > a { font-style: italic; }

/* Line Blocks */
div.line-block { display: block; }
div.line-block div.line-block {
  margin-top: 0;
  margin-bottom: 0;
  margin-left: 40px;
}

/* Figures, Images, and Tables */
.figure.align-left,
img.align-left,
object.align-left,
table.align-left {
  margin-right: auto;
}
.figure.align-center,
img.align-center,
object.align-center {
  margin-left: auto;
  margin-right: auto;
  display: block;
}
table.align-center {
  margin-left: auto;
  margin-right: auto;
}
.figure.align-right,
img.align-right,
object.align-right,
table.align-right {
  margin-left: auto;
}
/* reset inner alignment in figures and tables */
div.align-left, div.align-center, div.align-right,
table.align-left, table.align-center, table.align-right
{ text-align: inherit }

/* Admonitions and System Messages */
div.admonition,
div.system-message,
div.sidebar{
  margin: 40px;
  border: medium outset;
  padding-right: 1em;
  padding-left: 1em;
}

/* Sidebar */
div.sidebar {
  width: 30%;
  max-width: 26em;
  float: right;
  clear: right;
}

/* Text Blocks */
div.topic,
pre.literal-block,
pre.doctest-block,
pre.math,
pre.code {
  margin-right: 40px;
  margin-left: 40px;
}
pre.code .ln { color: gray; } /* line numbers */

/* Tables */
table { border-collapse: collapse; }
td, th {
  border-style: solid;
  border-color: silver;
  padding: 0 1ex;
  border-width: thin;
}
td > p:first-child, th > p:first-child { margin-top: 0; }
td > p, th > p { margin-bottom: 0; }

table > caption {
  text-align: left;
  margin-bottom: 0.25em
}

table.borderless td, table.borderless th {
  border: 0;
  padding: 0;
  padding-right: 0.5em /* separate table cells */
}

</style>
<style type="text/css">

/* CSS31_ style sheet for the output of Docutils HTML writers.             */
/* Rules for easy reading and pre-defined style variants.		   */
/*                                                                         */
/* :Author: Günter Milde, based on html4css1.css by David Goodger          */
/* :Id: $Id: plain.css 7952 2016-07-26 18:15:59Z milde $               */
/* :Copyright: © 2015 Günter Milde.                                        */
/* :License: Released under the terms of the `2-Clause BSD license`_,      */
/*    in short:                                                            */
/*                                                                         */
/*    Copying and distribution of this file, with or without modification, */
/*    are permitted in any medium without royalty provided the copyright   */
/*    notice and this notice are preserved.                                */
/*    	     	      	     	 					   */
/*    This file is offered as-is, without any warranty.                    */
/*                                                                         */
/* .. _2-Clause BSD license: http://www.spdx.org/licenses/BSD-2-Clause     */
/* .. _CSS3: http://www.w3.org/TR/CSS3		        		   */


/* Document Structure */
/* ****************** */

/* "page layout" */
body {
  padding: 0 5%;
  margin: 8px 0;
}
div.document {
  line-height:1.3;
  counter-reset: table;
  /* counter-reset: figure; */
  /* avoid long lines --> better reading */
  /* OTOH: lines should not be too short because of missing hyphenation, */
  max-width: 50em;
  margin: auto;
}

/* Sections */

/* Transitions */

hr.docutils {
  width: 80%;
  margin-top: 1em;
  margin-bottom: 1em;
  clear: both;
}

/* Paragraphs               */
/* ==========               */

/* vertical space (parskip) */
p, ol, ul, dl,
div.line-block,
table{
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}
h1, h2, h3, h4, h5, h6,
dl > dd {
  margin-bottom: 0.5em;
}

/* Lists                    */
/* ==========               */

/* Definition Lists         */

dl > dd p:first-child { margin-top: 0; }
/* :last-child is not part of CSS 2.1 (introduced in CSS 3) */
/* dl > dd p:last-child  { margin-bottom: 0; } */

/* lists nested in definition lists */
/* :only-child is not part of CSS 2.1 (introduced in CSS 3) */
dd > ul:only-child, dd > ol:only-child { padding-left: 1em; }

/* Description Lists */
/* styled like in most dictionaries, encyclopedias etc. */
dl.description > dt {
  font-weight: bold;
  clear: left;
  float: left;
  margin: 0;
  padding: 0;
  padding-right: 0.5em;
}

/* Field Lists */

/* example for custom field-name width */
dl.field-list.narrow > dd {
  margin-left: 5em;
}
/* run-in: start field-body on same line after long field names */
dl.field-list.run-in > dd p {
  display: block;
}

/* Bibliographic Fields */

/* generally, bibliographic fields use special definition list dl.docinfo */
/* but dedication and abstract are placed into "topic" divs */
div.abstract p.topic-title {
  text-align: center;
}
div.dedication {
  margin: 2em 5em;
  text-align: center;
  font-style: italic;
}
div.dedication p.topic-title {
  font-style: normal;
}

/* Citations */
dl.citation dt.label {
  font-weight: bold;
}
span.fn-backref {
  font-weight: normal;
}

/* Text Blocks           */
/* ============          */

/* Literal Blocks           */
pre.literal-block, pre.doctest-block,
pre.math, pre.code {
  margin-left: 1.5em;
  margin-right: 1.5em
}

/* Block Quotes             */

blockquote,
div.topic {
  margin-left: 1.5em;
  margin-right: 1.5em
}
blockquote > table,
div.topic > table {
  margin-top: 0;
  margin-bottom: 0;
}
blockquote p.attribution,
div.topic p.attribution {
  text-align: right;
  margin-left: 20%;
}

/* Tables                   */
/* ======                   */

/* th { vertical-align: bottom; } */

table tr { text-align: left; }

/* "booktabs" style (no vertical lines) */
table.booktabs {
  border: 0;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.booktabs * {
  border: 0;
}
table.booktabs th {
  border-bottom: thin solid;
}

/* numbered tables (counter defined in div.document) */
table.numbered > caption:before {
  counter-increment: table;
  content: "Table " counter(table) ": ";
  font-weight: bold;
}

/* Explicit Markup Blocks   */
/* ======================   */

/* Footnotes and Citations  */
/* -----------------------  */

/* line on the left */
dl.footnote {
  padding-left: 1ex;
  border-left: solid;
  border-left-width: thin;
}

/* Directives               */
/* ----------               */

/* Body Elements            */
/* ~~~~~~~~~~~~~            */

/* Images and Figures */

/* let content flow to the side of aligned images and figures */
.figure.align-left,
img.align-left,
object.align-left {
  display: block;
  clear: left;
  float: left;
  margin-right: 1em
}
.figure.align-right,
img.align-right,
object.align-right {
  display: block;
  clear: right;
  float: right;
  margin-left: 1em
}
/* Stop floating sidebars, images and figures at section level 1,2,3 */
h1, h2, h3 { clear: both; }

/* Sidebar */

/* Move into the margin. In a layout with fixed margins, */
/* it can be moved into the margin completely.		 */
div.sidebar {
  width: 30%;
  max-width: 26em;
  margin-left: 1em;
  margin-right: -5.5%;
  background-color: #ffffee ;
}

/* Code                     */

pre.code, code { background-color: #eeeeee }
pre.code .ln { color: gray; } /* line numbers */
/* basic highlighting: for a complete scheme, see */
/* http://docutils.sourceforge.net/sandbox/stylesheets/ */
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

/* Math                     */
/* styled separately (see math.css for math-output=HTML) */

/* Epigraph                 */
/* Highlights               */
/* Pull-Quote               */
/* Compound Paragraph       */
/* Container                */

/* can be styled in a custom stylesheet */

/* Document Header and Footer */

div.footer, div.header {
  clear: both;
  font-size: smaller;
}

/* Inline Markup            */
/* =============            */

/* Emphasis                 */
/*   em                     */
/* Strong Emphasis          */
/*   strong		    */
/* Interpreted Text         */
/*   span.interpreted  	    */
/* Title Reference 	    */
/*   cite		    */
/* Inline Literals          */
/* possible values: normal, nowrap, pre, pre-wrap, pre-line */
/*   span.docutils.literal { white-space: pre-wrap; } */

/* Hyperlink References     */
a { text-decoration: none; }

/* External Targets         */
/*   span.target.external   */
/* Internal Targets  	    */
/*   span.target.internal   */
/* Footnote References      */
/*   a.footnote-reference   */
/* Citation References      */
/*   a.citation-reference   */

</style>
</head>
<body>
<div class="document" id="kupfer-plugin-api">
<h1 class="title">Kupfer Plugin API</h1>

<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id1">Introduction</a></p>
<ul>
<li><p><a class="reference internal" href="#the-plugin-file" id="id2">The Plugin File</a></p></li>
<li><p><a class="reference internal" href="#a-short-working-example" id="id3">A Short Working Example</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#reference" id="id4">Reference</a></p>
<ul>
<li><p><a class="reference internal" href="#kupferobject" id="id5">KupferObject</a></p></li>
<li><p><a class="reference internal" href="#leaf" id="id6">Leaf</a></p></li>
<li><p><a class="reference internal" href="#action" id="id7">Action</a></p></li>
<li><p><a class="reference internal" href="#source" id="id8">Source</a></p></li>
<li><p><a class="reference internal" href="#textsource" id="id9">TextSource</a></p></li>
<li><p><a class="reference internal" href="#actiongenerator" id="id10">ActionGenerator</a></p></li>
<li><p><a class="reference internal" href="#the-plugin-runtime" id="id11">The Plugin Runtime</a></p></li>
<li><p><a class="reference internal" href="#kupfer-plugin-support" id="id12">kupfer.plugin_support</a></p></li>
<li><p><a class="reference internal" href="#plugin-packages-resources-and-distribution" id="id13">Plugin Packages, Resources and Distribution</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#example-plugins" id="id14">Example Plugins</a></p></li>
<li><p><a class="reference internal" href="#reference-to-the-kupfer-package" id="id15">Reference to the <span class="docutils literal">kupfer</span> Package</a></p></li>
</ul>
</div>
<div class="section" id="introduction">
<h1><a class="toc-backref" href="#id1">Introduction</a></h1>
<p>Kupfer is a Python program that allows loading extension modules
at runtime. A plugin is equivalent to one Python module implemented
as one <span class="docutils literal">.py</span> file or as a Python package.</p>
<p>The <span class="docutils literal">kupfer</span> package is organized as follows:</p>
<pre class="literal-block">kupfer/
    obj/
    ui/
    core/
    plugin/
        core/__init__.py
        applications.py
        ...
    ...</pre>
<p>Plugins live in the package <span class="docutils literal">kupfer.plugin</span>. Kupfer also includes
directories called <span class="docutils literal">kupfer/plugins</span> from <span class="docutils literal">$XDG_DATA_DIRS</span>, which
typically means <span class="docutils literal">/usr/share/kupfer/plugins</span> and
<span class="docutils literal"><span class="pre">$HOME/.local/share/kupfer/plugins</span></span>. These directories are
transparently included into the kupfer package, so the user has multiple
choices of where to install plugins.</p>
<div class="section" id="the-plugin-file">
<h2><a class="toc-backref" href="#id2">The Plugin File</a></h2>
<p>A kupfer plugin is a <span class="docutils literal">.py</span> file with some special attributes.</p>
<p>It starts like this (an imagined example):</p>
<pre class="literal-block">__kupfer_name__ = _(&quot;Cool X-Documents&quot;)
__kupfer_sources__ = (&quot;DocumentSource&quot;, )
__kupfer_text_sources__ = ()
__kupfer_actions__ = (&quot;Open&quot;, )
__description__ = _(&quot;Documents from the X program&quot;)
__version__ = &quot;1&quot;
__author__ = &quot;Tom Author&quot;</pre>
<p>All these special variables must be defined before any other code in the
module (even imports). For a plugin, the following attributes are
required:</p>
<pre class="literal-block">__kupfer_name__ (Localized name of plugin)
__description__ (Localized description of plugin)
__version__
__author__</pre>
<p>For the plugin to do anything, the following attributes may be defined:</p>
<pre class="literal-block">__kupfer_sources__ = ()
__kupfer_text_sources__ = ()
__kupfer_actions__ = ()
__kupfer_action_generators__ = ()
__kupfer_contents__ = ()</pre>
<p>They should be tuples of <em>names</em> of classes in the module:</p>
<ul class="simple">
<li><p>all sources have to be subclasses of <span class="docutils literal">kupfer.objects.Source</span></p></li>
<li><p>all text sources have to be subclasses of <span class="docutils literal">kupfer.objects.TextSource</span></p></li>
<li><p>all actions have to be subclasses of <span class="docutils literal">kupfer.objects.Action</span></p></li>
</ul>
<p>If an example plugin declares:</p>
<pre class="literal-block">__kupfer_sources__ = (&quot;DocumentSource&quot;, )</pre>
<p>it will later in the file define the class <span class="docutils literal">DocumentSource</span>:</p>
<pre class="literal-block">from kupfer.objects import Source

class DocumentSource (Source):
    def __init__(self):
        Source.__init__(self, _(&quot;Cool X-Documents&quot;))

    def get_items(self):
        ...
    # later we will see what we can do here!</pre>
<p>Ok, this looks simple. So what are Leaves, Sources and Actions?</p>
<p>A <strong>Leaf</strong> is an object, it represents a program or a file, or a text or
something else. Every type of Leaf has different possibilities, and you
can define new Leaves. Example: a <span class="docutils literal">FileLeaf</span> represents a file on the
disk.</p>
<p>A <strong>Source</strong> produces a collection of Leaves, so it makes Kupfer know
about new objects. For example, it can provide all the FileLeaves for a
particular folder.</p>
<p>An <strong>Action</strong> is the part where something happens, an action is applied
to a Leaf, and something happens. For example, <em>Open</em> can be an
action that works with all <span class="docutils literal">FileLeaf</span>.</p>
</div>
<div class="section" id="a-short-working-example">
<h2><a class="toc-backref" href="#id3">A Short Working Example</a></h2>
<p>The very simplest thing we can do is to provide an action on
objects that already exist in Kupfer. These actions appear in the
right-hand actions pane in kupfer, when an object of the right type is
selected.</p>
<p>The complete python code for the plugin:</p>
<pre class="code python literal-block"><code><span class="name">__kupfer_name__</span> <span class="operator">=</span> <span class="name">_</span><span class="punctuation">(</span><span class="literal string double">&quot;Image Viewer&quot;</span><span class="punctuation">)</span>
<span class="name">__kupfer_actions__</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="literal string double">&quot;View&quot;</span><span class="punctuation">,</span> <span class="punctuation">)</span>
<span class="name">__description__</span> <span class="operator">=</span> <span class="name">_</span><span class="punctuation">(</span><span class="literal string double">&quot;View images quickly&quot;</span><span class="punctuation">)</span>
<span class="name">__version__</span> <span class="operator">=</span> <span class="literal string double">&quot;&quot;</span>
<span class="name">__author__</span> <span class="operator">=</span> <span class="literal string double">&quot;Tom Author&quot;</span>


<span class="keyword namespace">from</span> <span class="name namespace">gi.repository</span> <span class="keyword namespace">import</span> <span class="name">Gtk</span>

<span class="keyword namespace">from</span> <span class="name namespace">kupfer.objects</span> <span class="keyword namespace">import</span> <span class="name">Action</span><span class="punctuation">,</span> <span class="name">FileLeaf</span>

<span class="keyword">class</span> <span class="name class">View</span> <span class="punctuation">(</span><span class="name">Action</span><span class="punctuation">):</span>
    <span class="keyword">def</span> <span class="name function magic">__init__</span><span class="punctuation">(</span><span class="name builtin pseudo">self</span><span class="punctuation">):</span>
        <span class="name builtin">super</span><span class="punctuation">()</span><span class="operator">.</span><span class="name function magic">__init__</span><span class="punctuation">(</span><span class="name">_</span><span class="punctuation">(</span><span class="literal string double">&quot;View&quot;</span><span class="punctuation">))</span>

    <span class="keyword">def</span> <span class="name function">item_types</span><span class="punctuation">(</span><span class="name builtin pseudo">self</span><span class="punctuation">):</span>
        <span class="keyword">yield</span> <span class="name">FileLeaf</span>

    <span class="keyword">def</span> <span class="name function">valid_for_item</span><span class="punctuation">(</span><span class="name builtin pseudo">self</span><span class="punctuation">,</span> <span class="name">fileobj</span><span class="punctuation">):</span>
        <span class="keyword">return</span> <span class="name">fileobj</span><span class="operator">.</span><span class="name">object</span><span class="operator">.</span><span class="name">endswith</span><span class="punctuation">(</span><span class="literal string double">&quot;.jpg&quot;</span><span class="punctuation">)</span>

    <span class="keyword">def</span> <span class="name function">activate</span><span class="punctuation">(</span><span class="name builtin pseudo">self</span><span class="punctuation">,</span> <span class="name">fileobj</span><span class="punctuation">):</span>
        <span class="name">image_widget</span> <span class="operator">=</span> <span class="name">Gtk</span><span class="operator">.</span><span class="name">Image</span><span class="operator">.</span><span class="name">new_from_file</span><span class="punctuation">(</span><span class="name">fileobj</span><span class="operator">.</span><span class="name">object</span><span class="punctuation">)</span>
        <span class="name">image_widget</span><span class="operator">.</span><span class="name">show</span><span class="punctuation">()</span>
        <span class="name">window</span> <span class="operator">=</span> <span class="name">Gtk</span><span class="operator">.</span><span class="name">Window</span><span class="punctuation">()</span>
        <span class="name">window</span><span class="operator">.</span><span class="name">add</span><span class="punctuation">(</span><span class="name">image_widget</span><span class="punctuation">)</span>
        <span class="name">window</span><span class="operator">.</span><span class="name">present</span><span class="punctuation">()</span></code></pre>
<p>That is all. What we did was the following:</p>
<ul class="simple">
<li><p>Declare a plugin called &quot;Image Viewer&quot; with an action class <span class="docutils literal">View</span>.</p></li>
<li><p>Every string inside <span class="docutils literal"><span class="pre">_(&quot;&quot;)</span></span> is translatable</p></li>
<li><p><span class="docutils literal">View</span> declares that it works with <span class="docutils literal">FileLeaf</span></p></li>
<li><p><span class="docutils literal">View</span> only accepts <span class="docutils literal">FileLeaf</span> that end with '.jpg'</p></li>
<li><p><span class="docutils literal">View</span> defines a method <span class="docutils literal">activate</span> that when called, will use gtk
to show the file in a window</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Kupfer uses a simplified programming style of composition and
cooperative superclasses.</p>
<p>You normally never call a superclass implementation inside a method
that you define, with the exception of <span class="docutils literal">__init__</span>.</p>
<p>On the other hand, there are superclass methods that should not be
overridden. For example, <span class="docutils literal">KupferObject.get_pixbuf</span> is never
overridden, instead you implement <span class="docutils literal">KupferObject.get_icon_name</span>.</p>
</div>
</div>
</div>
<div class="section" id="reference">
<h1><a class="toc-backref" href="#id4">Reference</a></h1>
<p>Below follows a complete summary. To accompany this reference, you can
read kupfer's inline module documentation with pydoc, by doing the
following in the source directory:</p>
<pre class="literal-block">$ pydoc kupfer.obj.base</pre>
<p>or equivalently:</p>
<pre class="literal-block">$ python
&gt;&gt;&gt; help(&quot;kupfer.obj.base&quot;)</pre>
<div class="section" id="kupferobject">
<h2><a class="toc-backref" href="#id5">KupferObject</a></h2>
<p><span class="docutils literal">class KupferObject</span> implements the things that are common to all objects:
<em>name</em>, <em>description</em>, <em>icon</em>, <em>thumbnail</em> and <em>name aliases</em>.</p>
<dl>
<dt><span class="docutils literal">__init__(self, name)</span></dt>
<dd><p>This is called when you call <span class="docutils literal">Leaf.__init__</span>, or <span class="docutils literal">Source.__init__</span>,
and so on in your object's <span class="docutils literal">__init__</span> method.</p>
<p>The name parameter must be a unicode string. An object can not
change name after it has called __init__.</p>
</dd>
<dt><span class="docutils literal">get_description(self)</span></dt>
<dd><p>Return a longer user-visible unicode string that
describes the object.</p>
</dd>
<dt><span class="docutils literal">get_icon_name(self)</span></dt>
<dd><p>Return a string of one icon name for the object.</p>
<p>The icon name should preferably be in the <a class="reference external" href="http://standards.freedesktop.org/icon-naming-spec/icon-naming-spec-latest.html">Icon Naming
Specification</a></p>
</dd>
<dt><span class="docutils literal">get_gicon(self)</span></dt>
<dd><p>Return a GIcon (GIO icon) object. This takes precedence
over the icon name, if it is defined.</p>
</dd>
<dt><span class="docutils literal">get_thumbnail(self, width, height)</span></dt>
<dd><p>Implement <span class="docutils literal">get_thumbnail</span> to return a GdkPixbuf object of the
requested size that is a thumbnail of the object. If applicable.</p>
</dd>
<dt><span class="docutils literal">get_pixbuf(self, x)</span></dt>
<dd><p>This should not be redefined. Define <span class="docutils literal">get_icon_name</span> and/or
<span class="docutils literal">get_gicon</span> instead.</p>
</dd>
<dt><span class="docutils literal">get_icon(self)</span></dt>
<dd><p>This should not be redefined. Define <span class="docutils literal">get_icon_name</span> and/or
<span class="docutils literal">get_gicon</span> instead.</p>
</dd>
<dt><span class="docutils literal">repr_key(self)</span></dt>
<dd><p>Return an object whose str() will be used in the __repr__,
self is returned by default.
This value is used to differentiate and recognize objects.
Override this if the objects type and name is not enough
to differentiate it from other objects.</p>
</dd>
<dt><span class="docutils literal">__repr__</span></dt>
<dd><p>This should not be redefined. Define <span class="docutils literal">repr_key</span> instead.</p>
</dd>
<dt><span class="docutils literal">kupfer_add_alias(self, alias)</span></dt>
<dd><p>This should not be redefined, but can be called by the object
to add an alternate name to the object.</p>
</dd>
</dl>
<div class="section" id="kupferobject-attributes">
<h3>KupferObject Attributes</h3>
<dl class="simple">
<dt><span class="docutils literal">KupferObject.rank_adjust</span></dt>
<dd><p>A number to adjust the ranking of a certain object. Should only
be used on Actions. Should be set in the range -10 to -1 for actions
that apply to many objects but not default for any.</p>
</dd>
<dt><span class="docutils literal">KupferObject.fallback_icon_name</span></dt>
<dd><p>Used as a the class' fallback for icon name. Do not change this.</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="leaf">
<h2><a class="toc-backref" href="#id6">Leaf</a></h2>
<p><span class="docutils literal">class Leaf</span> inherits from KupferObject.</p>
<p>A Leaf represents an object that the user will want to act on. Examples
are a file, an application or a free-text query (TextLeaf).</p>
<p>This defines, in addition to KupferObject:</p>
<dl>
<dt><span class="docutils literal">__init__(self, obj, name)</span></dt>
<dd><p>The default implementation of <span class="docutils literal">__init__</span> stores the parameter
<span class="docutils literal">obj</span> into <span class="docutils literal">self.object</span> and passes <span class="docutils literal">name</span> up to
<span class="docutils literal">KupferObject.__init__</span>.</p>
<p><span class="docutils literal">obj</span> can be any data that the Leaf represents. <span class="docutils literal">name</span> must be
a unicode string.</p>
</dd>
<dt><span class="docutils literal">Leaf.object</span></dt>
<dd><p><span class="docutils literal">Leaf.object</span> is the represented object, which is the
implementation-specific internal data.</p>
</dd>
<dt><span class="docutils literal">get_actions()</span></dt>
<dd><p>Return a sequence of Actions that always apply to the Leaf. These
are &quot;built-in&quot; actions.</p>
</dd>
<dt><span class="docutils literal">__hash__</span> and <span class="docutils literal">__eq__</span></dt>
<dd><p>Leaves are hashable, can be members in a set, and duplicates are
recognized (and removed); this is essential so that equivalent
Leaves from different sources are recognized.</p>
<p>These methods need normally not be overridden.</p>
<p>By default leaves are equal if both the name and the <span class="docutils literal">Leaf.object</span>
attribute are the same.</p>
</dd>
<dt><span class="docutils literal">has_content()</span> and <span class="docutils literal">content_source()</span></dt>
<dd><p>A leaf can contain something, like a folder contains files or a
music album songs.</p>
<p>If the Leaf should have content, it should override <span class="docutils literal">has_content</span>
to return <span class="docutils literal">True</span> and define <span class="docutils literal">content_source()</span> to return
an instance of a Source.</p>
<p>A Leaf may decide dynamically if it has content or not.</p>
</dd>
</dl>
</div>
<div class="section" id="action">
<h2><a class="toc-backref" href="#id7">Action</a></h2>
<p><span class="docutils literal">class Action</span> inherits from KupferObject.</p>
<p>An Action represents a command using a direct object and an optional
indirect object. One example is <span class="docutils literal">kupfer.obj.fileactions.Open</span> that
will open its direct object (which must be a file), with its default
viewer.</p>
<p>Actions are the most versatile parts of Kupfer, since they can define
ways to use objects together. They also have to decide, which types of
Leaves they apply to, and if they apply to a given Leaf.</p>
<p>An action is either a <cite>Subject + Verb</cite> action: It needs one object,
this is the direct object.</p>
<p>Or it is a <cite>Subject + Verb + Object</cite> action: It needs two objects,
one direct object (&quot;obj&quot;) and one indirect object (&quot;iobj&quot;).</p>
<p>Action defines, in addition to KupferObject:</p>
<div class="section" id="activate-carrying-out-the-action">
<h3>Activate: Carrying Out the Action</h3>
<dl>
<dt><span class="docutils literal">activate(self, obj)</span></dt>
<dd><p>Called to perform the action if the action is a normal
<cite>Subject + Verb</cite> action.</p>
</dd>
<dt><span class="docutils literal">activate(self, obj, iobj)</span></dt>
<dd><p>Called to perform the action if the action is a three-way
<cite>Subject + Verb + Object</cite> action. (That is, <span class="docutils literal">requires_object</span>
returns <span class="docutils literal">True</span>)</p>
</dd>
<dt><span class="docutils literal">activate_multiple(self, objects)</span></dt>
<dd><!--  -->
</dd>
<dt><span class="docutils literal">activate_multiple(self, objects, iobjects)</span></dt>
<dd><p>If implemented, <span class="docutils literal">activate_multiple</span> is called with preference over
<span class="docutils literal">activate(self, obj, iobj)</span> or <span class="docutils literal">activate(self, obj)</span> as
appropriate.</p>
<p>Implement <span class="docutils literal">activate_multiple</span> to handle multiple objects on either
side in a smart way.</p>
<p>You should implement <span class="docutils literal">activate_multiple</span> if it is possible to do
something better than the equivalent of repeating <span class="docutils literal">activate</span>
<em>n</em> times for <em>n</em> objects.</p>
</dd>
</dl>
<p><span class="docutils literal">activate</span> and <span class="docutils literal">activate_multiple</span> also receive a keyword argument
called <span class="docutils literal">ctx</span> if the action defines <span class="docutils literal">wants_context(self)</span> to return
<span class="docutils literal">True</span>. See <span class="docutils literal">wants_context</span> below for more information.</p>
</div>
<div class="section" id="determining-eligible-objects">
<h3>Determining Eligible Objects</h3>
<dl>
<dt><span class="docutils literal">item_types(self)</span></dt>
<dd><p>This method should return a sequence of all Leaf types
that the action can apply to (direct object).</p>
</dd>
<dt><span class="docutils literal">valid_for_item(self, item)</span></dt>
<dd><p>This method is called for each potential direct object
of the correct type.
Return True if the object is compatible with the action.</p>
<p>By default always returns <span class="docutils literal">True</span>.</p>
</dd>
<dt><span class="docutils literal">requires_object(self)</span></dt>
<dd><p>Return <span class="docutils literal">True</span> if the action is a <cite>Subject + Verb + Object</cite>
action and requires both a direct and an indirect object.</p>
<p>If <span class="docutils literal">requires_object</span> returns <span class="docutils literal">True</span>,  then you must must also
define (at least) <span class="docutils literal">object_types</span>.</p>
</dd>
<dt><span class="docutils literal">object_types(self)</span></dt>
<dd><p>Return a sequence of all Leaf types that are valid for the action's
indirect object.</p>
</dd>
<dt><span class="docutils literal">object_source(self, for_item)</span></dt>
<dd><p>If the action's indirect objects should not be picked from the full
catalog, but from a defined source, return an instance of the Source
here, else return None. <span class="docutils literal">for_item</span> is the direct object.</p>
</dd>
<dt><span class="docutils literal">object_source_and_catalog(self, for_item)</span></dt>
<dd><p>If the action has an object source, by default only that source is
used for indirect objects. Return <span class="docutils literal">True</span> here to use both the
custom source and the whole catalog.</p>
</dd>
<dt><span class="docutils literal">valid_object(self, iobj, for_item)</span></dt>
<dd><p>This method, if defined,  will be called for each indirect object
(with the direct object as <span class="docutils literal">for_item</span>), to decide if it can be
used. Return <span class="docutils literal">True</span> if it can be used.</p>
</dd>
</dl>
</div>
<div class="section" id="auxiliary-method-wants-context-self">
<h3>Auxiliary Method <span class="docutils literal">wants_context(self)</span></h3>
<dl>
<dt><span class="docutils literal">wants_context(self)</span></dt>
<dd><p>Return <span class="docutils literal">True</span> if <span class="docutils literal">activate</span> should receive an <span class="docutils literal">ExecutionToken</span>
as the keyword argument <span class="docutils literal">ctx</span>. This allows posting late
(after-the-fact) results and errors, as well as allowing access to
the GUI environment.</p>
<p><span class="docutils literal">wants_context</span> defaults to <span class="docutils literal">False</span> which corresponds to
the old protocol without <span class="docutils literal">ctx</span>.</p>
</dd>
</dl>
<p>So instead of <span class="docutils literal">activate(self, obj)</span>, the method should be implemented
as <span class="docutils literal">activate(self, obj, ctx)</span>.</p>
<p>The object passed as <span class="docutils literal">ctx</span> has the following interface:</p>
<dl>
<dt><span class="docutils literal">ctx.register_late_result(result_object)</span></dt>
<dd><p>Register the <span class="docutils literal">result_object</span> as a late result. It must be a
<span class="docutils literal">Leaf</span> or a <span class="docutils literal">Source</span>.</p>
</dd>
<dt><span class="docutils literal">ctx.register_late_error(exc_info=None)</span></dt>
<dd><p>Register an asynchronous error. (For synchronous errors, simply raise
an <span class="docutils literal">OperationError</span> inside <span class="docutils literal">activate</span>.)</p>
<p>For asynchronous errors, call <span class="docutils literal">register_late_error</span>. If
<span class="docutils literal">exc_info</span> is <span class="docutils literal">None</span>, the current exception is used.
If <span class="docutils literal">exc_info</span> is an <span class="docutils literal">OperationError</span> instance, then it is used
as error. Otherwise, a tuple like <span class="docutils literal">sys.exc_info()</span> can be passed.</p>
</dd>
<dt><span class="docutils literal">ctx.environment</span></dt>
<dd><p>The environment object, which has the following methods:</p>
<dl class="simple">
<dt><span class="docutils literal">get_timestamp(self)</span></dt>
<dd><p>Return the current event timestamp</p>
</dd>
<dt><span class="docutils literal">get_startup_notification_id(self)</span></dt>
<dd><p>Make and return a startup notification id</p>
</dd>
<dt><span class="docutils literal">get_display(self)</span></dt>
<dd><p>Return the display name (i.e <span class="docutils literal">:0.0</span>)</p>
</dd>
<dt><span class="docutils literal">present_window(self, window)</span></dt>
<dd><p>Present <span class="docutils literal">window</span> (a <span class="docutils literal">Gtk.Window</span>) on the current
workspace and monitor using the current event time.</p>
</dd>
</dl>
</dd>
</dl>
</div>
<div class="section" id="auxiliary-action-methods">
<h3>Auxiliary Action Methods</h3>
<p>Some auxiliary methods tell Kupfer about how to handle the action:</p>
<dl class="simple">
<dt><span class="docutils literal">is_factory(self)</span></dt>
<dd><p>Return <span class="docutils literal">True</span> if the return value of <span class="docutils literal">activate</span> is a source
that should be displayed immediately.</p>
</dd>
<dt><span class="docutils literal">has_result(self)</span></dt>
<dd><p>Return <span class="docutils literal">True</span> if the action's return value in <span class="docutils literal">activate</span> should
be selected.</p>
</dd>
<dt><span class="docutils literal">is_async(self)</span></dt>
<dd><p>Return <span class="docutils literal">True</span> if the action returns a <span class="docutils literal">Task</span> object conforming to
<span class="docutils literal">kupfer.task.Task</span> from <span class="docutils literal">activate</span>. The task will be executed
asynchronously in Kupfer's task queue.</p>
</dd>
<dt><span class="docutils literal">repr_key(self)</span></dt>
<dd><p>Override this to define a unique key for the action,
if you need to differentiate between different instances of the
same Action class.</p>
</dd>
</dl>
</div>
<div class="section" id="class-attributes">
<h3>Class Attributes</h3>
<p>The attribute <span class="docutils literal">action_accelerator</span> is <span class="docutils literal">None</span> by default but
can be a single letter string to suggest a default accelerator for
this action. Actions that act like the default open should use <span class="docutils literal">&quot;o&quot;</span>.</p>
</div>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id8">Source</a></h2>
<p><span class="docutils literal">class Source</span> inherits from KupferObject.</p>
<p>A Source understands specific data and delivers Leaves for it.</p>
<p>A Source subclass must at a minimum implement <span class="docutils literal">__init__</span>,
<span class="docutils literal">get_items</span> and <span class="docutils literal">provides</span>.</p>
<p><span class="docutils literal">Source</span> defines, in addition to <span class="docutils literal">KupferObject</span>:</p>
<dl>
<dt><span class="docutils literal">__init__(self, names)</span></dt>
<dd><p>You must call this method with a unicode name in the subclass
<span class="docutils literal">__init__(self)</span>.</p>
</dd>
<dt><span class="docutils literal">get_items(self)</span></dt>
<dd><p>Your source should define <span class="docutils literal">get_items</span> to return a sequence
of leaves which are its items; the return value is cached and used
until <span class="docutils literal">mark_for_update</span> is called.</p>
<p>Often, implementing <span class="docutils literal">get_items</span> in the style of a generator (using
<span class="docutils literal">yield</span>) is the most convenient.</p>
<p>The Leaves shall be returned in natural order (most relevant first),
or if sorting is required, return in any order and define
<span class="docutils literal">should_sort_lexically</span>.</p>
</dd>
<dt><span class="docutils literal">get_leaves(self)</span></dt>
<dd><p><span class="docutils literal">get_leaves</span> must not be overridden, define <span class="docutils literal">get_items</span>
instead.</p>
</dd>
<dt><span class="docutils literal">provides(self)</span></dt>
<dd><p>Return a sequence of all precise Leaf types the Source may contain.</p>
<p>Often, the Source contains Leaves of only one type, in that case
the implementation is written simply as <span class="docutils literal">yield ThatLeafType</span>.</p>
</dd>
<dt><span class="docutils literal">should_sort_lexically(self)</span></dt>
<dd><p>Return <span class="docutils literal">True</span> if the Source's leaves should be sorted
alphabethically. If not sorted lexically, <span class="docutils literal">get_items</span> should yield
leaves in order of the most relevant object first (for example the
most recently used).</p>
</dd>
<dt><span class="docutils literal">initialize(self)</span></dt>
<dd><p>This method is called when the source should be made ready to use.
This is where it should register for external change callbacks, for
example.</p>
</dd>
<dt><span class="docutils literal">finalize(self)</span></dt>
<dd><p>This method is called before the Source is disabled (shutdown or
plugin deactivated).</p>
</dd>
<dt><span class="docutils literal">get_leaf_repr(self)</span></dt>
<dd><p>Return a Leaf that represents the Source, if applicable; for example
the DirectorySource is represented by a FileLeaf for the directory.</p>
</dd>
<dt><span class="docutils literal">__hash__</span> and <span class="docutils literal">__eq__</span></dt>
<dd><p>Sources are hashable, and equivalents are recognized just like
Leaves, and the central SourceController manages them so that there
are no duplicates in the application.</p>
</dd>
<dt><span class="docutils literal">get_items_forced(self)</span></dt>
<dd><p>Like <span class="docutils literal">get_items</span>, called when a refresh is forced. By default
it just calls <span class="docutils literal">get_items</span>.</p>
</dd>
<dt><span class="docutils literal">mark_for_update(self)</span></dt>
<dd><p>Should not be overridden. Call <span class="docutils literal">mark_for_update</span> in the source to
mark it so that it is refreshed by calling <span class="docutils literal">get_items</span>.</p>
</dd>
<dt><span class="docutils literal">repr_key(self)</span></dt>
<dd><p>Define to a unique key if you need to differentiate between sources
of the same class. Normally only used with Sources from factory
actions or from decorator sources.</p>
</dd>
<dt><span class="docutils literal">toplevel_source(self)</span></dt>
<dd><p>If applicable, the source can return a different source to represent
it and its objects in the top level of the catalog. The default
implementation returns <span class="docutils literal">self</span> which is normally what you want.</p>
</dd>
<dt><span class="docutils literal">is_dynamic(self)</span></dt>
<dd><p>Return <span class="docutils literal">True</span> if the Source should not be cached. This is almost
never used.</p>
</dd>
</dl>
<div class="section" id="saving-source-configuration-data">
<h3>Saving Source configuration data</h3>
<p>These methods are must be implemented if the Source needs to save
user-produced configuration data.</p>
<dl>
<dt><span class="docutils literal">config_save_name(self)</span></dt>
<dd><p>Return the name key to save the data under. This should almost
always be literally <span class="docutils literal">return __name__</span></p>
</dd>
<dt><span class="docutils literal">config_save(self)</span></dt>
<dd><p>Implement this to return a datastructure that succintly but
perfectly represents the configuration data. The returned
value must be a composition of simple types, that is, nested
compositions of <span class="docutils literal">dict</span>, <span class="docutils literal">list</span>, <span class="docutils literal">str</span> etc.</p>
<p>This is called after <span class="docutils literal">finalize</span> is called on the source.</p>
</dd>
<dt><span class="docutils literal">config_restore(self, state)</span></dt>
<dd><p>The <span class="docutils literal">state</span> parameter is passed in as the saved return value
of <span class="docutils literal">config_save</span>. <span class="docutils literal">config_restore</span> is called before
<span class="docutils literal">initialize</span> is called on the Source.</p>
</dd>
</dl>
</div>
<div class="section" id="content-decorators">
<h3>Content Decorators</h3>
<p>A content-decorating source provides content to a Leaf, where it does
not control the Leaf. An example is the recent documents content
decorator, that provides document collections as content to
applications.</p>
<p>A normal Source listed in <span class="docutils literal">__kupfer_sources__</span> will be eligible for
content decoration as well if it implements the needed methods.
Otherwise content-only sources are listed in <span class="docutils literal">__kupfer_contents__</span>.</p>
<dl>
<dt><span class="docutils literal">&#64;classmethod decorates_type(cls)</span></dt>
<dd><p>Return the type of Leaf that can be decorated. You must also
implement <span class="docutils literal">decorate_item</span>.</p>
</dd>
<dt><span class="docutils literal">&#64;classmethod decorate_item(cls, leaf)</span></dt>
<dd><p>Return an instance of a Source (normally of the same type as the
content decorator itself) that is the content for the object
<span class="docutils literal">leaf</span>.  Return <span class="docutils literal">None</span> if not applicable.</p>
<p>Sources returned from <span class="docutils literal">decorate_item</span> go into the common Source
pool. The new source instance will not be used if the returned
instance is equivalent (as defined by class and <span class="docutils literal">reepr_key</span>
above).</p>
</dd>
</dl>
</div>
<div class="section" id="source-attributes">
<h3>Source Attributes</h3>
<dl class="simple">
<dt><span class="docutils literal">Source.source_user_reloadable = False</span></dt>
<dd><p>Set to <span class="docutils literal">True</span> if the source should have a user-visible
<em>Rescan</em> action. Normally you much prefer to use change
notifications so that this is not necessary.</p>
</dd>
<dt><span class="docutils literal">Source.source_prefer_sublevel = False</span></dt>
<dd><p>Set to <span class="docutils literal">True</span> to not export its objects to the top level by
default. Normally you don't wan't to change this</p>
</dd>
<dt><span class="docutils literal">Source.source_use_cache =  True`</span></dt>
<dd><p>If <span class="docutils literal">True</span>, the source can be pickled to disk to save its
cached items until the next time the launcher is started.</p>
</dd>
<dt><span class="docutils literal">Source._version</span></dt>
<dd><p>Internal number that is <span class="docutils literal">1</span> by default. Update this number in
<span class="docutils literal">__init__</span> to invalidate old versions of cache files.</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="textsource">
<h2><a class="toc-backref" href="#id9">TextSource</a></h2>
<p>TextSource inherits from KupferObject.</p>
<p>A text source returns items for a given text string, it is much like a
simplified version of Source. At a minimum, a TextSource subclass must
implement <span class="docutils literal">get_text_items</span> and <span class="docutils literal">provides</span>.</p>
<dl class="simple">
<dt><span class="docutils literal">__init__(self, name)</span></dt>
<dd><p>Override as <span class="docutils literal">__init__(self)</span> to provide a unicode name for the
source.</p>
</dd>
<dt><span class="docutils literal">get_text_items(self, text)</span></dt>
<dd><p>Return a sequence of Leaves for the unicode string <span class="docutils literal">text</span>.</p>
</dd>
<dt><span class="docutils literal">provides(self)</span></dt>
<dd><p>Return a sequence of the Leaf types it may contain</p>
</dd>
<dt><span class="docutils literal">get_rank(self)</span></dt>
<dd><p>Return a static rank score for text output of this source.</p>
</dd>
</dl>
</div>
<div class="section" id="actiongenerator">
<h2><a class="toc-backref" href="#id10">ActionGenerator</a></h2>
<p>ActionGenerator inherits from object.</p>
<p>ActionGenerator is a helper object that can be declared in
<span class="docutils literal">__kupfer_action_generators__</span>. It allows generating action objects
dynamically.</p>
<dl class="simple">
<dt><span class="docutils literal">get_actions_for_leaf(self, leaf)</span></dt>
<dd><p>Return a sequence of Action objects appropriate for this Leaf</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <span class="docutils literal">ActionGenerator</span> should not perform any expensive
computation, and not access any slow media (files, network) when
returning actions.  Such expensive checks must postponed and be
performed in each Action's <span class="docutils literal">valid_for_item</span> method.</p>
</div>
</div>
<div class="section" id="the-plugin-runtime">
<h2><a class="toc-backref" href="#id11">The Plugin Runtime</a></h2>
<div class="topic">
<p class="topic-title first">How a plugin is activated</p>
<ol class="arabic">
<li><p>The plugin module is imported into Kupfer.</p>
<p>If an error occurs, the loading fails and the plugin is disabled.
If the error raised is an ImportError then Kupfer report it as a
dependency problem.</p>
</li>
<li><p>Kupfer will initialize a <span class="docutils literal">kupfer.plugin_support.PluginSettings</span>
object if it exists (see next section)</p></li>
<li><p>Kupfer will call the module-level function
<span class="docutils literal">initialize_plugin(name)</span> if it exists.</p></li>
<li><p>Kupfer instantiates the declared sources and actions and insert
sources, actions, content decorators, action generators and text
sources into the catalog.</p></li>
</ol>
</div>
<div class="topic">
<p class="topic-title first">When a plugin is deactivated</p>
<p>When the plugin is disabled, the module-level function
<span class="docutils literal">finalize_plugin(name)</span> is called if it exists. [It is not yet
final whether this function is called at shutdown or only when
hot-unplugging plugins.]</p>
</div>
</div>
<div class="section" id="kupfer-plugin-support">
<h2><a class="toc-backref" href="#id12">kupfer.plugin_support</a></h2>
<p>This module provides important API for several plugin features.</p>
<div class="section" id="pluginsettings">
<h3>PluginSettings</h3>
<p>To use user-settable configuration parameters, use:</p>
<pre class="code python literal-block"><code><span class="name">__kupfer_settings__</span> <span class="operator">=</span> <span class="name">plugin_support</span><span class="operator">.</span><span class="name">PluginSettings</span><span class="punctuation">(</span>
    <span class="punctuation">{</span>
        <span class="literal string double">&quot;key&quot;</span> <span class="punctuation">:</span> <span class="literal string double">&quot;frobbers&quot;</span><span class="punctuation">,</span>
        <span class="literal string double">&quot;label&quot;</span><span class="punctuation">:</span> <span class="name">_</span><span class="punctuation">(</span><span class="literal string double">&quot;Number of frobbers&quot;</span><span class="punctuation">),</span>
        <span class="literal string double">&quot;type&quot;</span><span class="punctuation">:</span> <span class="name builtin">int</span><span class="punctuation">,</span>
        <span class="literal string double">&quot;value&quot;</span><span class="punctuation">:</span> <span class="literal number integer">9</span><span class="punctuation">,</span>
    <span class="punctuation">},</span>
<span class="punctuation">)</span></code></pre>
<p>Where <span class="docutils literal">PluginSettings</span> takes a variable argument list of config
parameter descriptions. The configuration values are accessed with
<span class="docutils literal">__kupfer_settings__[key]</span> where <span class="docutils literal">key</span> is from the parameter
description. Notice that <span class="docutils literal">__kupfer_settings__</span> is not updated with
the user values until the plugin is properly initialized.</p>
<p><span class="docutils literal">PluginSettings</span> is read-only but supports the GObject signal
<span class="docutils literal"><span class="pre">plugin-setting-changed</span> (key, value)</span> when values change.</p>
</div>
<div class="section" id="check-dbus-support-and-check-keyring-support">
<h3>check_dbus_support and check_keyring_support</h3>
<p><span class="docutils literal">plugin_support</span> provides the convenience functions
<span class="docutils literal">check_dbus_support()</span> and <span class="docutils literal">check_keyring_support()</span> that raise the
appropriate error if a dependency is missing.</p>
</div>
<div class="section" id="alternatives">
<h3>Alternatives</h3>
<p>Alternatives are mutually exclusive features where the user must select
which to use. Each category permits one choice.</p>
<div class="topic">
<p class="topic-title first">Categories of Alternatives</p>
<dl class="field-list simple">
<dt><span class="docutils literal">terminal</span></dt>
<dd><p>the terminal used for running programs that require
terminal</p>
</dd>
<dt><span class="docutils literal">icon_renderer</span></dt>
<dd><p>method used to look up icon names</p>
</dd>
</dl>
</div>
<p>Each category has a specific format of required data that is defined in
<span class="docutils literal">kupfer/plugin_support.py</span>. A plugin should use the function
<span class="docutils literal">kupfer.plugin_support.register_alternative(caller, category_key, id_, **kwargs)</span>
to register their implementations of new alternatives. The arguments are:</p>
<div class="topic">
<p class="topic-title first"><span class="docutils literal">register_alternative(caller, category_key, id_, ** kwargs)</span></p>
<dl class="field-list simple">
<dt><span class="docutils literal">caller</span></dt>
<dd><p>the name of the calling plugin, is always <span class="docutils literal">__name__</span></p>
</dd>
<dt><span class="docutils literal">category_key</span></dt>
<dd><p>one of the above categories</p>
</dd>
<dt><span class="docutils literal">id_</span></dt>
<dd><p>the plugin's identifier for the alternative</p>
</dd>
<dt><cite>kwargs</cite></dt>
<dd><p>key-value pairs defining the alternative</p>
</dd>
</dl>
<p><span class="docutils literal">register_alternative</span> is normally called in the plugin's
<span class="docutils literal"><span class="pre">initialize_plugin(..)</span></span> function.</p>
</div>
<div class="topic">
<p class="topic-title first">Fields requried for the category <span class="docutils literal">terminal</span></p>
<dl class="field-list simple">
<dt><span class="docutils literal">name</span></dt>
<dd><p>unicode visible name</p>
</dd>
<dt><span class="docutils literal">argv</span></dt>
<dd><p>argument list: list of byte strings</p>
</dd>
<dt><span class="docutils literal">exearg</span></dt>
<dd><p>the execute-flag as a byte string (<span class="docutils literal">&quot;&quot;</span> when N/A)</p>
</dd>
<dt><span class="docutils literal">desktopid</span></dt>
<dd><p>the likely application id as a byte string</p>
</dd>
<dt><span class="docutils literal">startup_notify</span></dt>
<dd><p>whether to use startup notification as boolean</p>
</dd>
</dl>
</div>
<div class="topic">
<p class="topic-title first">Fields required for the category <span class="docutils literal">icon_renderer</span></p>
<dl class="field-list simple">
<dt><span class="docutils literal">name</span></dt>
<dd><p>unicode visible name</p>
</dd>
<dt><span class="docutils literal">renderer</span></dt>
<dd><p>an object with an interface just like
<span class="docutils literal">kupfer.icons.IconRenderer</span></p>
</dd>
</dl>
</div>
</div>
</div>
<div class="section" id="plugin-packages-resources-and-distribution">
<h2><a class="toc-backref" href="#id13">Plugin Packages, Resources and Distribution</a></h2>
<p>A plugin is a Python module–either a single python file or a folder with
an <span class="docutils literal">__init__.py</span> file (a package module). In the latter case, the
whole of the plugin can be defined inside <span class="docutils literal">__init__.py</span>, or it can be
split into several modules. Kupfer will look for all the description
variables (like <span class="docutils literal">__kupfer_name__</span>) in <span class="docutils literal">__init__.py</span>.</p>
<div class="topic">
<p class="topic-title first">Plugin-installed custom icons</p>
<p>A package module may include custom icons as .svg files. The icon files
must be declared in a file inside the python package called
<span class="docutils literal"><span class="pre">icon-list</span></span>.</p>
<ul class="simple">
<li><p>Each line is a tab-separated field list, with the icon name in
the first column and the filename (relative to the plugin package)
in the second column.</p></li>
<li><p>Lines can be commented with a leading <span class="docutils literal">#</span></p></li>
<li><p>If a literal <span class="docutils literal">!override</span> appears in the third column, the icon
is installed even if it overrides the currently used GTK icon
theme.</p></li>
</ul>
</div>
<p>Plugins may be installed into any of the <span class="docutils literal">kupfer/plugins</span> data
directories. Package modules can also be installed and used as <span class="docutils literal">.zip</span>
files, so they too can be distributed as single files.</p>
</div>
</div>
<div class="section" id="example-plugins">
<h1><a class="toc-backref" href="#id14">Example Plugins</a></h1>
<p>I want to specifically highlight certain files in Kupfer that are good
to read as examples.</p>
<ul class="simple">
<li><p>Custom Leaf and Action: the common case of creating a custom
<span class="docutils literal">Leaf</span> type and defining its default <span class="docutils literal">Open</span> action, see
<span class="docutils literal">kupfer/plugin/notes.py</span></p></li>
<li><p>Content decoration: making content for objects, see
<span class="docutils literal">kupfer/plugin/archiveinside.py</span> (<em>Deep Archives</em> plugin)</p></li>
<li><p>Asynchronous error reporting: see <span class="docutils literal">kupfer/plugin/volumes.py</span>, action
<em>Unmount</em></p></li>
</ul>
</div>
<div class="section" id="reference-to-the-kupfer-package">
<h1><a class="toc-backref" href="#id15">Reference to the <span class="docutils literal">kupfer</span> Package</a></h1>
<p>There are several modules inside the <span class="docutils literal">kupfer</span> package that a plugin
can reuse.</p>
<div class="topic">
<p class="topic-title first"><span class="docutils literal">kupfer.commandexec</span></p>
<p><span class="docutils literal">kupfer.commandexec</span> is not used by plugins anymore
after version v204. See <a class="reference internal" href="#auxiliary-method-wants-context-self">Auxiliary Method wants_context(self)</a>
above instead.</p>
</div>
<div class="topic">
<p class="topic-title first"><span class="docutils literal">kupfer.config</span></p>
<!--  -->
</div>
<div class="topic">
<p class="topic-title first"><span class="docutils literal">kupfer.interface</span></p>
<p>This module does not need to be imported just to implement the
interface it defines.</p>
<dl class="simple">
<dt><span class="docutils literal">TextRepresentation</span></dt>
<dd><dl class="simple">
<dt><span class="docutils literal">get_text_representation</span></dt>
<dd><p>If a Leaf has a text representation (used for
copy-to-clipboard), it should implement this method
and return a unicode string.</p>
</dd>
</dl>
</dd>
</dl>
</div>
<div class="topic">
<p class="topic-title first"><span class="docutils literal">kupfer.kupferstring</span></p>
<p>A <strong>byte string</strong> (Python <span class="docutils literal">str</span>) is just a stream of data. When
you handle byte strings that is text, you must convert it to unicode
as soon as possible. You only know the encoding depending on the
source of the byte string.</p>
<dl class="simple">
<dt><span class="docutils literal">tounicode</span></dt>
<dd><p>decode UTF-8 or unicode object into unicode.</p>
</dd>
<dt><span class="docutils literal">tolocale(ustr)</span></dt>
<dd><p>coerce unicode <span class="docutils literal">ustr</span> into a locale-encoded bytestring.</p>
</dd>
<dt><span class="docutils literal">fromlocale(lstr)</span></dt>
<dd><p>decode locale-encoded bytestring <span class="docutils literal">lstr</span> to a unicode object.</p>
</dd>
</dl>
</div>
<div class="topic">
<p class="topic-title first"><span class="docutils literal">kupfer.objects</span></p>
<p><span class="docutils literal">kupfer.objects</span> includes the basic objects from the package
<span class="docutils literal">kupfer.obj</span>, such as <span class="docutils literal">Leaf</span>, <span class="docutils literal">Action</span>, <span class="docutils literal">Source</span> etc.</p>
<dl>
<dt><span class="docutils literal">FileLeaf</span>, <span class="docutils literal">AppLeaf</span>, <span class="docutils literal">TextLeaf</span> etc.</dt>
<dd><p>The basic re-usable types live here</p>
</dd>
<dt><span class="docutils literal">OperationError</span></dt>
<dd><p>Exception type for user-visible errors in action execution.
Raise <span class="docutils literal">OperationError</span> with a unicode localized error message
inside <span class="docutils literal">Action.activate</span> to notify the user of a serious
error.</p>
<p>Specialized versions exist: Such as
<span class="docutils literal">NotAvailableError(toolname)</span>,
<span class="docutils literal">NoMultiError()</span></p>
</dd>
</dl>
</div>
<div class="topic">
<p class="topic-title first"><span class="docutils literal">kupfer.pretty</span></p>
<!--  -->
</div>
<div class="topic">
<p class="topic-title first"><span class="docutils literal">kupfer.runtimehelper</span></p>
<!--  -->
</div>
<div class="topic">
<p class="topic-title first"><span class="docutils literal">kupfer.textutils</span></p>
<!--  -->
</div>
<div class="topic">
<p class="topic-title first"><span class="docutils literal">kupfer.uiutils</span></p>
<dl>
<dt><span class="docutils literal">show_notification(title, <span class="pre">text='',</span> <span class="pre">icon_name='',</span> nid=0)</span></dt>
<dd><p>Show a notification. If a previous return value is passed as
<span class="docutils literal">nid</span> , try to replace that previous notification.</p>
<p>Returns a notification identifier, or None if notifications
are not supported.</p>
</dd>
</dl>
</div>
<div class="topic">
<p class="topic-title first"><span class="docutils literal">kupfer.utils</span></p>
<dl class="simple">
<dt><span class="docutils literal">spawn_async(argv)</span></dt>
<dd><p>Spawn a child process, returning True if successfully started.</p>
</dd>
<dt><span class="docutils literal">spawn_in_terminal(argv)</span></dt>
<dd><!--  -->
</dd>
<dt><span class="docutils literal">show_path(path)</span></dt>
<dd><!--  -->
</dd>
<dt><span class="docutils literal">show_url(url)</span></dt>
<dd><p>Display with default viewer for <span class="docutils literal">path</span> or <span class="docutils literal">url</span>.</p>
</dd>
<dt><span class="docutils literal">get_display_path_for_bytestring(filepath)</span></dt>
<dd><p>File paths are bytestrings (and are not text).
<span class="docutils literal">get_display_path_for_bytestring</span> returns a user-displayable
text representation as a unicode object.</p>
</dd>
</dl>
</div>
<div class="topic">
<p class="topic-title first"><span class="docutils literal">kupfer.task</span></p>
<!--  -->
</div>
<div class="topic">
<p class="topic-title first"><span class="docutils literal">kupfer.weaklib</span></p>
<!--  -->
</div>
<div class="topic">
<p class="topic-title first"><span class="docutils literal">kupfer.core</span></p>
<p>The module <span class="docutils literal">kupfer.core</span> can not be used by plugins.</p>
</div>
<!-- vim: ft=rst tw=72 et sts=4 sw=4 -->
<!-- this document best viewed with rst2html -->
</div>
</div>
</body>
</html>
